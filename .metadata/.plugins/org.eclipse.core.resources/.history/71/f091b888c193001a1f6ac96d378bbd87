/*
 * SignalManager.c
 *
 *  Created on: 9 May 2020
 *      Author: chris
 */


#include "SignalManager.h"

#define MCLK 168000000		// MCU master clock frequency
#define FSAMP 120			// sampling frequency, defined in WaveTableGeneratiom scripts

uint16_t SM_GetEncoderValue(eEncoder_Direction direction)
{
	if(direction)
	{
		return ENCODER_TIMER->ARR - ENCODER_TIMER->CNT;
	}
	else
	{
		return ENCODER_TIMER->CNT;
	}
}

uint32_t SM_GetOutputInHertz()
{
	volatile uint32_t TIM8PSC;
	volatile uint32_t TIM8ARR;

	// safe-guard against divide by zero
	(TIM8->PSC == 0) ? (TIM8PSC = 1) : (TIM8PSC = TIM8->PSC);
	(TIM8->ARR == 0) ? (TIM8ARR = 1) : (TIM8ARR = TIM8->ARR);

	uint32_t tim8_freq = MCLK / (TIM8PSC * TIM8ARR);

	return tim8_freq / FSAMP;
}
